@push('scripts')
<script>
    let editorInstance;

    document.addEventListener('livewire:initialized', function () {
        initializeCKEditor();
    });

    document.addEventListener('livewire:navigated', function () {
        initializeCKEditor();
    });

    function initializeCKEditor() {
        setTimeout(() => {
            if (typeof ClassicEditor !== 'undefined') {
                const element = document.querySelector('#description');
                if (element) {
                    if (editorInstance) {
                        editorInstance.destroy().catch(error => console.log(error));
                    }

                    ClassicEditor
                        .create(element, {
                            toolbar: ['undo', 'redo', '|', 'heading', '|', 'bold', 'italic', '|', 'bulletedList', 'numberedList', '|', 'link'],
                        })
                        .then(editor => {
                            editorInstance = editor;
                            const initialContent = @this.get('description') || '';
                            editor.setData(initialContent);
                            editor.model.document.on('change:data', () => {
                                @this.set('description', editor.getData());
                            });
                        })
                        .catch(error => console.error('CKEditor error:', error));
                }
            }
        }, 100);
    }

    document.addEventListener('livewire:navigating', function () {
        if (editorInstance) {
            editorInstance.destroy().catch(error => console.log(error));
        }
    });
</script>
@endpush
